<!-- 
 * Aori Admin Portal Employee page
 * 
 * @author Xiaobo
 * @date 2025-10-12
 * @version 1.0 
 */
 -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Employee Management</title>
    <!-- Include Font Awesome for icons (Edit/Delete) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
<div layout:fragment="content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Employee Management</h1>
        
        <!-- Button to navigate to the Create New Employee Form -->
        <div class="btn-toolbar mb-2 mb-md-0">
            <a th:href="@{/admin/employees/new}" class="btn btn-primary">
                <i class="fas fa-user-plus me-2"></i> Create New Employee
            </a>
        </div>
    </div>

    <!-- Success/Error Message Display (for post-redirect messages) -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Employee Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th scope="col">ID (UUID)</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Role</th>
                    <th scope="col">Status</th>
                    <th scope="col">Created</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Check if the employees list is empty -->
                <tr th:if="${employees.isEmpty()}">
                    <td colspan="7" class="text-center text-muted py-4">No employees found in the system.</td>
                </tr>
                
                <!-- Iterate over the list of employees -->
                <tr th:each="employee : ${employees}">
                    <!-- Employee ID (shortened for display) -->
                    <td th:text="${#strings.substring(employee.employeeId, 0, 8) + '...'}">Employee ID</td>
                    
                    <!-- Full Name -->
                    <td>
                        <span th:text="${employee.firstName}"></span>
                        <span th:text="${employee.lastName}"></span>
                    </td>
                    
                    <!-- Email -->
                    <td th:text="${employee.email}"></td>
                    
                    <!-- Role Name (using optional chaining for null check) -->
                    <td>
                        <span th:if="${employee.role != null}" th:text="${employee.role.roleName}">Admin</span>
                        <span th:unless="${employee.role != null}" class="badge bg-secondary">Unassigned</span>
                    </td>
                    
                    <!-- Status with dynamic badge styling -->
                    <td>
                        <span th:switch="${employee.status.name()}">
                            <span th:case="'Active'" class="badge bg-success">Active</span>
                            <span th:case="'Inactive'" class="badge bg-warning text-dark">Inactive</span>
                            <span th:case="'Suspended'" class="badge bg-danger">Suspended</span>
                            <span th:case="*" class="badge bg-secondary" th:text="${employee.status.name()}">Unknown</span>
                        </span>
                    </td>

                    <!-- Created At Timestamp (formatted) -->
                    <td th:text="${#temporals.format(employee.createdAt, 'dd-MMM-yyyy')}">2025-10-10</td>
                    
                    <!-- Actions Column -->
                    <td>
                        <!-- Edit Button -->
                        <a th:href="@{'/admin/employees/' + ${employee.employeeId} + '/edit'}" 
                           class="btn btn-sm btn-outline-info me-2" 
                           title="Edit Employee">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        
                        <!-- Delete Button (using a link for simplicity in MVC, but best practice is POST form) -->
                        <a th:href="@{'/admin/employees/' + ${employee.employeeId} + '/delete'}" 
                           class="btn btn-sm btn-outline-danger" 
                           onclick="return confirm('Are you sure you want to delete this employee? This action cannot be undone.');"
                           title="Delete Employee">
                            <i class="fas fa-trash-alt"></i> Delete
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>